<!DOCTYPE html>
<html lang="en">
{% load static %}
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">

    <title>Survey Kepuasan</title>
    <meta content="" name="description">
    <meta content="" name="keywords">

    <!-- Favicons -->
    <link href="{% static 'survey/assets_frontend/img/kardinah.png' %}" rel="icon">
    <link href="{% static 'survey/assets_frontend/assets/img/apple-touch-icon.png' %}" rel="apple-touch-icon">

    <!-- Google Fonts -->
    <link
        href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
        rel="stylesheet">

    <!-- Vendor CSS Files -->
    <link href="{% static 'survey/assets_frontend/assets/vendor/aos/aos.css' %}" rel="stylesheet">
    <link href="{% static 'survey/assets_frontend/assets/vendor/bootstrap/css/bootstrap.min.css' %}" rel="stylesheet">
    <link href="{% static 'survey/assets_frontend/assets/vendor/bootstrap-icons/bootstrap-icons.css' %}" rel="stylesheet">
    <link href="{% static 'survey/assets_frontend/assets/vendor/boxicons/css/boxicons.min.css' %}" rel="stylesheet">
    <link href="{% static 'survey/assets_frontend/assets/vendor/glightbox/css/glightbox.min.css' %}" rel="stylesheet">
    <link href="{% static 'survey/assets_frontend/assets/vendor/swiper/swiper-bundle.min.css' %}" rel="stylesheet">

    <link href="{% static 'fontawesomefree/css/all.min.css' %}" rel="stylesheet" type="text/css">

    <!-- Template Main CSS File -->
    <link href="{% static 'survey/assets_frontend/assets/css/style.css' %}" rel="stylesheet">
    {# <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" #}
        {# integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous"> #}

    <link rel="stylesheet" href="{% static 'survey/assets_frontend/assets/css/font-awesome.6.0.0.all.min.css' %}" />
    <link rel="stylesheet" href="{% static 'survey/assets_frontend/assets/css/kioskboard-2.3.0.min.css' %}" />
    <script src="{% static 'survey/assets_frontend/assets/js/kioskboard-2.3.0.min.js' %}"></script>
    <style>
        .ratting input[type="radio"] {
            display: none;
        }



        .ratting label {
            cursor: pointer;
            width: 50px;
            height: 50px;
            font-size: 40px;
            /* Ubah ukuran ikon hati sesuai kebutuhan */
            color: darkgrey;
            /* Warna awal ikon hati (merah) */
            display: inline-block;
        }

        .ratting input:checked+label {
            color: orange;
            /* Warna ikon hati saat dipilih (kuning) */
        }

        .card {
            width: 780px;
            height: fit-content;
            background-color: #dadcde4f;
            border: 1px solid #ccc;
            border-radius: 30px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .card-header {
            background-color: orange;
            /* Header card dengan tingkat transparansi */
            border-top-left-radius: 10px;
            border-top-right-radius: 10px;

            border-radius: 40px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            padding: 10px;
            font-weight: bold;
            font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
        }

        .navbar {

            font-weight: bold;
            font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
        }

        textarea#comments {

            background-color: white;
            /* Warna oranye dengan tingkat transparansi */
            border: 1px;
            border-radius: 5px;
            padding: 5px;
            width: 70%;
            /* Lebar 100% agar lebih lebar */
            min-height: 100px;
            /* Ketinggian minimum agar tidak terlalu pendek */
            resize: vertical;
            /* Izinkan pengguna mengubah ukuran vertikal */
        }
    </style>
</head>

<body>
    <!-- ======= Header ======= -->
    <header id="header" class="fixed-top " style="background-color: transparent;">
        <div class="container d-flex align-items-center justify-content-between">

            <div class="logo">
                <h1><a href=""><img src="{% static 'survey/assets_frontend/img/kardinah.png' %}" class="img-fluid" alt="" width="50">
                        RSUD KARDINAH</a></h1>
            </div>

            <nav id="navbar" class="navbar">

                <i class="bi bi-list mobile-nav-toggle"></i>
            </nav><!-- .navbar -->

        </div>
    </header><!-- End Header -->

    <div class="row content " style="
    background-image: url('{% static 'survey/assets_frontend/img/card1.png' %}');
    background-position: center;
    background-repeat: no-repeat;
    background-size: cover;
    ">
        <div class="col-md-4" data-aos="fade-right">
            <img src="{% static 'survey/assets/img/details-5.png' %}" class="img-fluid" alt="">
        </div>
        <div class="col-md-8 pt-5" data-aos="fade-up">
            <br>
            <div class="card" style="background-image: url('img/card1.png');">
                <div class="card-header">
                    <h3 class="text-center " style="color: white;">Survei Kepuasan Pelayanan</h3>
                </div>
                <div class="card-body">
                    <form id="surveyForm" class="text-center" method="POST" action="#" enctype="multipart/form-data">
                        {% csrf_token %}
                        <div class="row justify-content-center">
                            <div class="form-group col-8">
                                <label for="instalasi">Masukkan Nomor Rekam Medis (NoRM)</label>
                                <div class="d-flex">
                                    <input type="text" class="form-control" id="norm" maxlength="7" onkeypress="validate(event)" name="norm" value="">
                                    <input type="button" class="btn btn-primary ms-2" id="cekNoRMBtn" name="checknorm" value="Cek">
                                    <input type="hidden" id="noregistrasi" name="noregistrasi" value="">
                                </div>
                            </div>
                        </div>
                        <div class="row justify-content-center">
                            <!-- <div class="col-md-6 pt-1">
                                <label for="instalasi">Nama</label>
                                <input type="text" class="form-control" style="background-color: white;"
                                name="namapasien" id="namapasien" disabled="disabled" value="">
                            </div> -->
                            <div class="col-md-8 pt-1 col">
                                <label for="ruangan">Ruangan</label>
                                <input type="text" class="form-control" style="background-color: white;" name="namaruangan" id="namaruangan"
                                disabled="disabled" value="">
                            </div>
                        </div>
                        <div class="row mt-2">
                            <div class="col-6">
                                <div class="form-group">
                                    <label for="fasilitasrating">Fasilitas</label>
                                    <span class="star-rating form-control" style="background-color: transparent; border: none;">
                                        <label for="fasilitas-rate-1" style="--i:1"><i class="fa-solid fa-star"></i></label>
                                        <input type="radio" name="fasilitas-rating" id="fasilitas-rate-1" value="1" checked>
                                        <label for="fasilitas-rate-2" style="--i:2"><i class="fa-solid fa-star"></i></label>
                                        <input type="radio" name="fasilitas-rating" id="fasilitas-rate-2" value="2">
                                        <label for="fasilitas-rate-3" style="--i:3"><i class="fa-solid fa-star"></i></label>
                                        <input type="radio" name="fasilitas-rating" id="fasilitas-rate-3" value="3">
                                        <label for="fasilitas-rate-4" style="--i:4"><i class="fa-solid fa-star"></i></label>
                                        <input type="radio" name="fasilitas-rating" id="fasilitas-rate-4" value="4">
                                        <label for="fasilitas-rate-5" style="--i:5"><i class="fa-solid fa-star"></i></label>
                                        <input type="radio" name="fasilitas-rating" id="fasilitas-rate-5" value="5">
                                    </span>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="form-group">
                                    <label for="farmasirating">Farmasi</label>
                                    <span class="star-rating form-control" style="background-color: transparent; border: none;">
                                        <label for="farmasi-rate-1" style="--i:1"><i class="fa-solid fa-star"></i></label>
                                        <input type="radio" name="farmasi-rating" id="farmasi-rate-1" value="1" checked>
                                        <label for="farmasi-rate-2" style="--i:2"><i class="fa-solid fa-star"></i></label>
                                        <input type="radio" name="farmasi-rating" id="farmasi-rate-2" value="2">
                                        <label for="farmasi-rate-3" style="--i:3"><i class="fa-solid fa-star"></i></label>
                                        <input type="radio" name="farmasi-rating" id="farmasi-rate-3" value="3">
                                        <label for="farmasi-rate-4" style="--i:4"><i class="fa-solid fa-star"></i></label>
                                        <input type="radio" name="farmasi-rating" id="farmasi-rate-4" value="4">
                                        <label for="farmasi-rate-5" style="--i:5"><i class="fa-solid fa-star"></i></label>
                                        <input type="radio" name="farmasi-rating" id="farmasi-rate-5" value="5">
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="row mt-2">
                            <div class="col-6">
                                <div class="form-group">
                                    <label for="perawatrating">Perawat</label>
                                    <span class="star-rating form-control" style="background-color: transparent; border: none;">
                                        <label for="perawat-rate-1" style="--i:1"><i class="fa-solid fa-star"></i></label>
                                        <input type="radio" name="perawat-rating" id="perawat-rate-1" value="1" checked>
                                        <label for="perawat-rate-2" style="--i:2"><i class="fa-solid fa-star"></i></label>
                                        <input type="radio" name="perawat-rating" id="perawat-rate-2" value="2">
                                        <label for="perawat-rate-3" style="--i:3"><i class="fa-solid fa-star"></i></label>
                                        <input type="radio" name="perawat-rating" id="perawat-rate-3" value="3">
                                        <label for="perawat-rate-4" style="--i:4"><i class="fa-solid fa-star"></i></label>
                                        <input type="radio" name="perawat-rating" id="perawat-rate-4" value="4">
                                        <label for="perawat-rate-5" style="--i:5"><i class="fa-solid fa-star"></i></label>
                                        <input type="radio" name="perawat-rating" id="perawat-rate-5" value="5">
                                    </span>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="form-group">
                                    <label for="dokterrating">Dokter</label>
                                    <span class="star-rating form-control" style="background-color: transparent; border: none;">
                                        <label for="dokter-rate-1" style="--i:1"><i class="fa-solid fa-star"></i></label>
                                        <input type="radio" name="dokter-rating" id="dokter-rate-1" value="1" checked>
                                        <label for="dokter-rate-2" style="--i:2"><i class="fa-solid fa-star"></i></label>
                                        <input type="radio" name="dokter-rating" id="dokter-rate-2" value="2">
                                        <label for="dokter-rate-3" style="--i:3"><i class="fa-solid fa-star"></i></label>
                                        <input type="radio" name="dokter-rating" id="dokter-rate-3" value="3">
                                        <label for="dokter-rate-4" style="--i:4"><i class="fa-solid fa-star"></i></label>
                                        <input type="radio" name="dokter-rating" id="dokter-rate-4" value="4">
                                        <label for="dokter-rate-5" style="--i:5"><i class="fa-solid fa-star"></i></label>
                                        <input type="radio" name="dokter-rating" id="dokter-rate-5" value="5">
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="row mt-4">
                            <div class="col-12">
                                <div class="d-flex align-items-center justify-content-center">
                                    <label for="comments">Komentar Anda:</label><br>
                                </div>
                                <div class="mt-2 d-flex align-items-start row">
                                    <div class="nav flex-column nav-pills ms-3 col-2" id="v-pills-tab" role="tablist" aria-orientation="vertical">
                                        <button class="nav-link active" id="v-pills-home-tab" data-bs-toggle="pill" data-bs-target="#v-pills-home"
                                            type="button" role="tab" aria-controls="v-pills-home" aria-selected="true">Ketik</button>
                                        <button class="nav-link" id="v-pills-profile-tab" data-bs-toggle="pill" data-bs-target="#v-pills-profile"
                                            type="button" role="tab" aria-controls="v-pills-profile" aria-selected="false">Rekam</button>
                                    </div>
                                    <div class="tab-content col-8" id="v-pills-tabContent">
                                        <div class="tab-pane fade show active" id="v-pills-home" 
                                        role="tabpanel" aria-labelledby="v-pills-home-tab">
                                            <textarea id="comments" name="komentar" rows="4" style="font-size: 30px" class="js-kioskboard-input"
                                                data-kioskboard-type="all" data-kioskboard-placement="bottom" data-kioskboard-specialcharacters="true"
                                                placeholder="Masukan Saran"></textarea>
                                        </div>
                                        <div class="tab-pane fade" id="v-pills-profile" role="tabpanel" aria-labelledby="v-pills-profile-tab">
                                            <div >
                                                <audio controls class="audio-element">
                                                </audio>
                                            </div>
                                            <button class="btn btn-warning" type="button" onclick="startAudioRecording()"><i class="fa fa-solid fa-record"></i><span id="">Mulai</span></button>
                                            <button class="btn btn-danger" type="button" onclick="cancelAudioRecording()"><i class="fa fa-solid fa-record"></i><span id="">Batal</span></button>
                                            <button class="btn btn-secondary" type="button" onclick="StopAudioRecording()"><i class="fa fa-solid fa-record"></i><span id="">Berhenti</span></button>
                                        </div>
                                    </div>
                                </div>
                                <button class="btn btn-primary mt-3" type="button" onclick="kirimSurvey()">Kirim Survei</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>





    <!-- ======= Footer ======= -->
    <footer id="footer">

        <div class="container py-4">
            <div class="copyright">
                &copy; Copyright <strong><span>PDE</span></strong>. RSUD KARDINAH
            </div>
            <div class="credits">
                Designed by <a href="#">PDE</a>
            </div>
        </div>
    </footer><!-- End Footer -->

    <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i
            class="bi bi-arrow-up-short"></i></a>

    <!-- Vendor JS Files -->
    <script src="{% static 'survey/assets_frontend/assets/vendor/aos/aos.js' %}"></script>
    <script src="{% static 'survey/assets_frontend/assets/vendor/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
    <script src="{% static 'survey/assets_frontend/assets/vendor/glightbox/js/glightbox.min.js' %}"></script>
    <script src="{% static 'survey/assets_frontend/assets/vendor/swiper/swiper-bundle.min.js' %}"></script>
    <script src="{% static 'survey/assets_frontend/assets/vendor/php-email-form/validate.js' %}"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Template Main JS File -->
    <script>
        $(document).ready(function () {
            $('#instalasi').change(function () {
                var selectedInstalasi = $(this).val();
                $('#ruangan').html('<option value="">Pilih Ruangan</option>'); // Reset dropdown ruangan

                if (selectedInstalasi) {
                    $.ajax({
                        url: '/get-ruangan/' +
                            selectedInstalasi, // Ganti dengan rute yang sesuai di aplikasi Anda
                        method: 'GET',
                        success: function (data) {
                            $('#ruangan').html(data);
                        }
                    });
                }
            });
        });
    </script>
    <script>
        KioskBoard.init({
            keysArrayOfObjects: null,
            keysJsonUrl: "{% static 'assets/dist/kioskboard-keys-english.json' %}",
            keysSpecialCharsArrayOfStrings: null,
            keysNumpadArrayOfNumbers: null,
            language: 'en',
            theme: 'light',
            autoScroll: true,
            capsLockActive: true,
            allowRealKeyboard: false,
            allowMobileKeyboard: false,
            cssAnimations: true, // CSS animations duration as millisecond 
            cssAnimationsDuration: 360, // CSS animations style for opening or closing the keyboard => "slide" || "fade" 
            cssAnimationsStyle: 'slide', // Enable or Disable Spacebar functionality on the keyboard. The Spacebar will be passive when "false" 
            keysAllowSpacebar: true, // Text of the Space key (Spacebar). Without text => " " 
            keysSpacebarText: 'Space', // Font family of the keys 
            keysFontFamily: 'sans-serif', // Font size of the keys 
            keysFontSize: '15px', // Font weight of the keys 
            keysFontWeight: 'normal', // Size of the icon keys 
            keysIconSize: '15px', // Text of the Enter key (Enter/Return). Without text => " " 
            keysEnterText: 'Enter', // The callback function of the Enter key. This function will be called when the enter key has been clicked. 
            keysEnterCallback: undefined, // The Enter key can close and remove the keyboard. Prevented when "false" 
            keysEnterCanClose: true,
        });
        $(document).ready(function () {
            $('#instalasi').change(function () {
                var selectedInstalasi = $(this).val();
                var $ruanganDropdown = $('#ruangan');
                $ruanganDropdown.empty();

                if (selectedInstalasi) {
                    var url = $(this).attr('data-url') + '/' + selectedInstalasi;
                    $.get(url, function (data) {
                        $ruanganDropdown.append($('<option>', {
                            value: "",
                            text: "Pilih Ruangan"
                        }
                        ));
                        data.forEach(function (ruangan) {
                            $ruanganDropdown.append($('<option>', {
                                value: ruangan.id,
                                text: ruangan.ruangan
                            }
                            ));
                        });
                    });
                }
            });
            KioskBoard.run('.js-kioskboard-input', {
                // ...init options 
            });
        });
    </script>
    <script src="{% static 'survey/assets_frontend/assets/js/main.js' %}"></script>
    <script>
        // script.js
        var formElement = document.getElementById('surveyForm')
        var audioElement = document.getElementsByClassName("audio-element")[0];
        var audioElementSource = document.getElementsByClassName("audio-element")[0]
            .getElementsByTagName("source")[0];
        var audioBlobFinished

        async function kirimSurvey(){
            let formData = new FormData(formElement);
            noreg = formData.get('noregistrasi')
            if (noreg != null && noreg != undefined && noreg != "") {
                if (audioBlobFinished != undefined && audioBlobFinished != null && audioBlobFinished != "") {
                    formData.append('voice', audioBlobFinished, 'voice.ogg')
                }
                console.log(formData)
                const req = fetch("{% url 'survey-kirim' %}" + noreg, {
                    method: "POST",
                    body: formData,
                })
                req.then(async (response) => {
                   let respjson = await response.json()
                    console.log(respjson)
                    if (respjson.success) {
                        alert("Data Berhasil disimpan.")
                        window.open('/', '_self');
                        /* document.getElementById('noregistrasi').value = ""
                        document.getElementById('norm').value = ""
                        document.getElementById('namaruangan').value = ""
                        document.getElementById('comments').value = ""
                        document.querySelector('input[name="fasilitas-rating"]:checked').checked = false;
                        document.querySelector('input[name="farmasi-rating"]:checked').checked = false;
                        document.querySelector('input[name="perawat-rating"]:checked').checked = false;
                        document.querySelector('input[name="dokter-rating"]:checked').checked = false;
                        */
                    } else {
                        alert(respjson.error)
                    }
                    return respjson 
                }).catch(err=>{
                    console.log(err)
                })
            } else {
                alert("Silahkan Cek NoRM!")
            }
        }


        async function kirimSuaraAlihTeks(){
            let formData = new FormData();
            norm = document.getElementById('norm').value
            csrf = document.getElementsByTagName('csrfmiddlewaretoken').value
            if ((norm != null && norm != undefined && norm != ""
            ) && (audioBlobFinished != undefined && audioBlobFinished != null && audioBlobFinished != "")) {
                formData.append('voice', audioBlobFinished, 'voice.ogg')
                formData.append('norm', norm)
                formData.append('csrfmiddlewaretoken', document.querySelector('input[name="csrfmiddlewaretoken"]').value)
                console.log(formData)
                const req = fetch("{% url 'survey-stt-direct' %}", {
                    method: "POST",
                    body: formData,
                })
                req.then(async (response) => {
                   let respjson = await response.json()
                    console.log(respjson)
                    if (respjson.success && respjson.data.length != 0) {
                        alert("Berhasil mengubah suara ke teks.")
                        document.getElementById('comments').value = respjson.data[0]
                        /* document.getElementById('noregistrasi').value = ""
                        document.getElementById('norm').value = ""
                        document.getElementById('namaruangan').value = ""
                        document.querySelector('input[name="fasilitas-rating"]:checked').checked = false;
                        document.querySelector('input[name="farmasi-rating"]:checked').checked = false;
                        document.querySelector('input[name="perawat-rating"]:checked').checked = false;
                        document.querySelector('input[name="dokter-rating"]:checked').checked = false;
                        */
                    } else {
                        alert(respjson.error)
                    }
                    return respjson 
                }).catch(err=>{
                    console.log(err)
                })
            } else {
                if (norm == null || norm == undefined || norm == ""){
                    alert("Silahkan Cek NoRM dan Rekam Ulang!")
                } else if (audioBlobFinished == undefined || audioBlobFinished == null || audioBlobFinished == "") {
                    alert("Silahkan Rekam Suara Anda!")
                }
            }
        }

        async function getRequest(url) {
            const response = await fetch(url);
            const jsons = await response.json();
            return jsons
        }

        async function postRequestJSON(url = "", data = {}) {
            // Default options are marked with *
            const response = await fetch(url, {
                method: "POST", // *GET, POST, PUT, DELETE, etc.
                mode: "cors", // no-cors, *cors, same-origin
                cache: "no-cache", // *default, no-cache, reload, force-cache, only-if-cached
                credentials: "same-origin", // include, *same-origin, omit
                headers: {
                    "Content-Type": "application/json",
                    // 'Content-Type': 'application/x-www-form-urlencoded',
                },
                redirect: "follow", // manual, *follow, error
                referrerPolicy: "no-referrer", // no-referrer, *no-referrer-when-downgrade, origin, origin-when-cross-origin, same-origin, strict-origin, strict-origin-when-cross-origin, unsafe-url
                body: JSON.stringify(data), // body data type must match "Content-Type" header
            });
            jsons = await response.json()
            return jsons; // parses JSON response into native JavaScript objects
        }

        async function postRequestForm(url, formData) {
            try {
                const response = await fetch(url, {
                    method: "POST",
                    body: formData,
                });
                const result = await response.json();
                return result
            } catch (error) {
                console.error("Error:", error);
                return null
            }
        }


        function validate(evt) {
            var theEvent = evt || window.event;

            // Handle paste
            if (theEvent.type === 'paste') {
                key = event.clipboardData.getData('text/plain');
            } else {
                // Handle key press
                var key = theEvent.keyCode || theEvent.which;
                key = String.fromCharCode(key);
            }
            var regex = /[0-9]|\./;
            if (!regex.test(key)) {
                theEvent.returnValue = false;
                if (theEvent.preventDefault) theEvent.preventDefault();
            }
        }


        document.getElementById('cekNoRMBtn').addEventListener('click', function(){
            norm = document.getElementById('norm').value
            getRequest("{% url 'survey-riwayat-pelayanan' %}" + norm).then((response) => {
                if (response.success) {
                    document.getElementById('namaruangan').value = response.data.ruangan
                    document.getElementById('noregistrasi').value = response.data.noregistrasi
                } else {
                    alert(response.error)
                }
            })
        })


        function createSourceForAudioElement() {
            let sourceElement = document.createElement("source");
            audioElement.appendChild(sourceElement);

            audioElementSource = sourceElement;
        }


        function playAudio(recorderAudioAsBlob) {

            //read content of files (Blobs) asynchronously
            let reader = new FileReader();

            //once content has been read
            reader.onload = (e) => {
                //store the base64 URL that represents the URL of the recording audio
                let base64URL = e.target.result;

                //If this is the first audio playing, create a source element
                //as pre populating the HTML with a source of empty src causes error
                if (!audioElementSource) //if its not defined create it (happens first time only)
                    createSourceForAudioElement();

                //set the audio element's source using the base64 URL
                audioElementSource.src = base64URL;

                //set the type of the audio element based on the recorded audio's Blob type
                let BlobType = recorderAudioAsBlob.type.includes(";") ?
                    recorderAudioAsBlob.type.substr(0, recorderAudioAsBlob.type.indexOf(';')) : recorderAudioAsBlob.type;
                audioElementSource.type = BlobType

                //call the load method as it is used to update the audio element after changing the source or other settings
                audioElement.load();

                //play the audio after successfully setting new src and type that corresponds to the recorded audio
                console.log("Playing audio...");
                audioElement.play();
            };

            //read content and convert it to a URL (base64)
            reader.readAsDataURL(recorderAudioAsBlob);
        }

        
        /* document.getElementById('surveyForm').addEventListener('change', function () {
            const ratting = document.querySelector('input[name="ratting"]:checked').value;
            const starLabels = document.querySelectorAll('.ratting label');

            // Reset semua bintang menjadi warna awal merah
            starLabels.forEach((label, index) => {
                label.style.color = 'darkgrey'; // Warna merah
                if (index < ratting) {
                    label.style.color = 'orange'; // Warna kuning untuk bintang yang sesuai dengan peringkat
                }
            });
        }); */
        var audioRecorder = {
            /** Stores the recorded audio as Blob objects of audio data as the recording continues*/
            audioBlobs: [], /*of type Blob[]*/
            /** Stores the reference of the MediaRecorder instance that handles the MediaStream when recording starts*/
            mediaRecorder: null, /*of type MediaRecorder*/
            /** Stores the reference to the stream currently capturing the audio*/
            streamBeingCaptured: null, /*of type MediaStream*/
            /** Start recording the audio
              * @returns {Promise} - returns a promise that resolves if audio recording successfully started
              */
            start: function () {
                //Feature Detection
                if (!(navigator.mediaDevices && navigator.mediaDevices.getUserMedia)) {
                    //Feature is not supported in browser
                    //return a custom error
                    return Promise.reject(new Error('mediaDevices API or getUserMedia method is not supported in this browser.'));
                }
                else {
                    //Feature is supported in browser
                    //create an audio stream
                    return navigator.mediaDevices.getUserMedia({ audio: true }/*of type MediaStreamConstraints*/)
                        //returns a promise that resolves to the audio stream
                        .then(stream /*of type MediaStream*/ => {

                            //save the reference of the stream to be able to stop it when necessary
                            audioRecorder.streamBeingCaptured = stream;

                            //create a media recorder instance by passing that stream into the MediaRecorder constructor
                            audioRecorder.mediaRecorder = new MediaRecorder(stream); /*the MediaRecorder interface of the MediaStream Recording
                        API provides functionality to easily record media*/

                            //clear previously saved audio Blobs, if any
                            audioRecorder.audioBlobs = [];

                            //add a dataavailable event listener in order to store the audio data Blobs when recording
                            audioRecorder.mediaRecorder.addEventListener("dataavailable", event => {
                                //store audio Blob object
                                audioRecorder.audioBlobs.push(event.data);
                            });

                            //start the recording by calling the start method on the media recorder
                            audioRecorder.mediaRecorder.start();
                            
                        });

                    /* errors are not handled in the API because if its handled and the promise is chained, the .then after the catch will be executed*/
                }
            },
            /** Stop the started audio recording
                * @returns {Promise} - returns a promise that resolves to the audio as a blob file
                */
            stop: function () {
                //return a promise that would return the blob or URL of the recording
                return new Promise(resolve => {
                    //save audio type to pass to set the Blob type
                    let mimeType = audioRecorder.mediaRecorder.mimeType;

                    //listen to the stop event in order to create & return a single Blob object
                    audioRecorder.mediaRecorder.addEventListener("stop", () => {
                        //create a single blob object, as we might have gathered a few Blob objects that needs to be joined as one
                        let audioBlob = new Blob(audioRecorder.audioBlobs, { type: mimeType });

                        //resolve promise with the single audio blob representing the recorded audio
                        resolve(audioBlob);
                    });
                    audioRecorder.cancel();
                });
            },
            /** Stop all the tracks on the active stream in order to stop the stream and remove
            * the red flashing dot showing in the tab
            */
            stopStream: function () {
                //stopping the capturing request by stopping all the tracks on the active stream
                audioRecorder.streamBeingCaptured.getTracks() //get all tracks from the stream
                    .forEach(track /*of type MediaStreamTrack*/ => track.stop()); //stop each one
            },
            /** Reset all the recording properties including the media recorder and stream being captured*/
            resetRecordingProperties: function () {
                audioRecorder.mediaRecorder = null;
                audioRecorder.streamBeingCaptured = null;

                /*No need to remove event listeners attached to mediaRecorder as
                If a DOM element which is removed is reference-free (no references pointing to it), the element itself is picked
                up by the garbage collector as well as any event handlers/listeners associated with it.
                getEventListeners(audioRecorder.mediaRecorder) will return an empty array of events.*/
            },
            /** Cancel audio recording*/
            cancel: function () {
                //stop the recording feature
                audioRecorder.mediaRecorder.stop();

                //stop all the tracks on the active stream in order to stop the stream
                audioRecorder.stopStream();

                //reset API properties for next recording
                audioRecorder.resetRecordingProperties();
            }
        }

        function startAudioRecording() {
            //start recording using the audio recording API
            audioRecorder.start()
                .then(() => { //on success
                    console.log("Recording Audio...")
                })
                .catch(error => { //on error
                    //No Browser Support Error
                    if (error.message.includes("mediaDevices API or getUserMedia method is not supported in this browser.")) {
                        console.log("To record audio, use browsers like Chrome and Firefox.");
                        switch (error.name) {
                            case 'AbortError': //error from navigator.mediaDevices.getUserMedia
                                console.log("An AbortError has occured.");
                                break;
                            case 'NotAllowedError': //error from navigator.mediaDevices.getUserMedia
                                console.log("A NotAllowedError has occured. User might have denied permission.");
                                break;
                            case 'NotFoundError': //error from navigator.mediaDevices.getUserMedia
                                console.log("A NotFoundError has occured.");
                                break;
                            case 'NotReadableError': //error from navigator.mediaDevices.getUserMedia
                                console.log("A NotReadableError has occured.");
                                break;
                            case 'SecurityError': //error from navigator.mediaDevices.getUserMedia or from the MediaRecorder.start
                                console.log("A SecurityError has occured.");
                                break;
                            case 'TypeError': //error from navigator.mediaDevices.getUserMedia
                                console.log("A TypeError has occured.");
                                break;
                            case 'InvalidStateError': //error from the MediaRecorder.start
                                console.log("An InvalidStateError has occured.");
                                break;
                            case 'UnknownError': //error from the MediaRecorder.start
                                console.log("An UnknownError has occured.");
                                break;
                            default:
                                console.log("An error occured with the error name " + error.name);
                        };
                    }
                });
        }

        /** Stops the currently started audio recording
        */
        function StopAudioRecording() {
            //stop the recording using the audio recording API
            console.log("Stopping Audio Recording...")
            audioRecorder.stop()
                .then(audioAsblob => { //stopping makes promise resolves to the blob file of the recorded audio
                    console.log("stopped with audio Blob:", audioAsblob);

                    //Do something with the recorded audio
                    //...
                    playAudio(audioAsblob)
                    audioBlobFinished = audioAsblob
                    kirimSuaraAlihTeks()
                })
                .catch(error => {
                    //Error handling structure
                    switch (error.name) {
                        case 'InvalidStateError': //error from the MediaRecorder.stop
                            console.log("An InvalidStateError has occured.");
                            break;
                        default:
                            console.log("An error occured with the error name " + error.name);
                    };

                });
        };

        /** Cancel the currently started audio recording */
        function cancelAudioRecording() {
            console.log("Canceling audio...");
            //cancel the recording using the audio recording API
            audioRecorder.cancel();

            //Do something after audio recording is cancelled
        }
    </script>

</body>

</html>